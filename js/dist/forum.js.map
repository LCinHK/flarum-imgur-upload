{"version":3,"sources":["webpack://@matteocontrini/flarum-imgur-upload/webpack/bootstrap","webpack://@matteocontrini/flarum-imgur-upload/./forum.js","webpack://@matteocontrini/flarum-imgur-upload/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@matteocontrini/flarum-imgur-upload/./src/forum/components/UploadButton.js","webpack://@matteocontrini/flarum-imgur-upload/./src/forum/index.js","webpack://@matteocontrini/flarum-imgur-upload/external \"flarum.core.compat['Component']\"","webpack://@matteocontrini/flarum-imgur-upload/external \"flarum.core.compat['components/LoadingIndicator']\"","webpack://@matteocontrini/flarum-imgur-upload/external \"flarum.core.compat['components/TextEditor']\"","webpack://@matteocontrini/flarum-imgur-upload/external \"flarum.core.compat['extend']\"","webpack://@matteocontrini/flarum-imgur-upload/external \"flarum.core.compat['helpers/icon']\""],"names":["UploadButton","init","isLoading","isSuccess","isError","document","addEventListener","paste","bind","view","attrs","className","title","app","translator","trans","config","el","domElement","$","tooltip","buttonIcon","LoadingIndicator","component","icon","label","m","type","accept","onchange","formUpload","disabled","e","clipboardData","items","item","startsWith","file","getAsFile","upload","target","files","redraw","formData","FormData","append","ajax","url","forum","attribute","headers","data","cache","contentType","processData","success","error","response","val","imageLink","link","previewLink","width","extensionIndex","lastIndexOf","slice","proxyimageLink","replace","proxypreviewLink","stringToInject","props","textArea","insertAtCursor","setTimeout","console","Component","initializers","add","extend","TextEditor","prototype"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import Component from 'flarum/Component';\nimport icon from 'flarum/helpers/icon';\nimport LoadingIndicator from 'flarum/components/LoadingIndicator';\n\nexport default class UploadButton extends Component {\n    init() {\n        this.isLoading = false;\n        this.isSuccess = false;\n        this.isError = false;\n\n        document.addEventListener('paste', this.paste.bind(this));\n    }\n\n    view() {\n        let attrs = {\n            className: 'Button hasIcon imgur-upload-button',\n            title: app.translator.trans('imgur-upload.forum.upload'),\n            config: (el) => {\n                this.domElement = el;\n                $(el).tooltip();\n            }\n        };\n\n        let buttonIcon;\n        if (this.isLoading) buttonIcon = LoadingIndicator.component({ className: 'Button-icon' });\n        else if (this.isSuccess) buttonIcon = icon('fas fa-check green', { className: 'Button-icon' });\n        else if (this.isError) buttonIcon = icon('fas fa-times red', { className: 'Button-icon' });\n        else buttonIcon = icon('far fa-image', { className: 'Button-icon' });\n\n        let label = '';\n        if (this.isLoading) label = app.translator.trans('imgur-upload.forum.loading');\n        else if (this.isSuccess) label = app.translator.trans('imgur-upload.forum.done');\n        else if (this.isError) label = app.translator.trans('imgur-upload.forum.error');\n\n        // When there is no label, the component element should be shown as a square button\n        if (label == '') {\n            attrs.className += ' Button--icon';\n        }\n\n        return m('div', attrs, [\n            buttonIcon,\n                m('span', { className: 'Button-label' }, label),\n                m('form#imgur-upload-form', [\n                    m('input', {\n                        type: 'file',\n                        accept: 'image/*',\n                        onchange: this.formUpload.bind(this),\n                        // disable button while doing things\n                        disabled: this.isLoading || this.isSuccess || this.isError\n                    })\n                ])\n            ]\n        );\n    }\n\n    paste(e) {\n        if (this.isLoading) return;\n\n        if (e.clipboardData && e.clipboardData.items) {\n            let item = e.clipboardData.items[0];\n\n            if (!item.type.startsWith('image')) {\n                return;\n            }\n\n            let file = item.getAsFile();\n            this.upload(file);\n        }\n    }\n\n    formUpload(e) {\n        let file = $(e.target)[0].files[0];\n        this.upload(file);\n    }\n\n    upload(file) {\n        $(this.domElement).tooltip('hide'); // force removal of the tooltip\n        this.isLoading = true;\n        m.redraw();\n\n        let formData = new FormData();\n        formData.append('image', file);\n\n        $.ajax({\n            url: app.forum.attribute('imgur-upload.API-URL'),\n            headers: {\n                'Authorization': 'Client-ID ' + app.forum.attribute('imgur-upload.client-id')\n            },\n            type: 'POST',\n            data: formData,\n            cache: false,\n            contentType: false,\n            processData: false,\n            success: this.success.bind(this),\n            error: this.error.bind(this)\n        });\n    }\n\n    success(response) {\n        $('#imgur-upload-form input').val('');\n\n        this.isLoading = false;\n        this.isSuccess = true;\n        m.redraw();\n\n        let imageLink = response.data.link;\n        let previewLink = imageLink;\n\n        // If the image is large, use a smaller version as the preview image\n        if (response.data.width > 1024) {\n            let extensionIndex = previewLink.lastIndexOf('.');\n            previewLink = previewLink.slice(0, extensionIndex) + 'h' + previewLink.slice(extensionIndex);\n        }\n      let proxyimageLink = imageLink.replace(\"https://i.imgur.com\",app.forum.attribute('imgur-upload.image-URL'));\n      let proxypreviewLink = previewLink.replace(\"https://i.imgur.com\",app.forum.attribute('imgur-upload.image-URL'));\n\n      let stringToInject = `[URL=${proxyimageLink}][IMG]${proxypreviewLink}[/IMG][/URL]\\n`;\n        this.props.textArea.insertAtCursor(stringToInject);\n\n        // After a bit, re-enable upload\n        setTimeout(() => {\n            this.isSuccess = false;\n            m.redraw();\n        }, 2000);\n    }\n\n    error(response) {\n        $('#imgur-upload-form').val('');\n\n        this.isLoading = false;\n        this.isError = true;\n        m.redraw();\n\n        // Output the error to the console, for debugging purposes\n        console.error(response);\n\n        // After a bit, re-enable upload\n        setTimeout(() => {\n            this.isError = false;\n            m.redraw();\n        }, 2000);\n    }\n}\n","import { extend } from 'flarum/extend';\nimport TextEditor from 'flarum/components/TextEditor';\nimport UploadButton from './components/UploadButton';\n\napp.initializers.add('imgur-upload', function() {\n\textend(TextEditor.prototype, 'controlItems', function(items) {\n\t\titems.add('imgur-upload', <UploadButton textArea={this} />);\n\t});\n});\n","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['components/LoadingIndicator'];","module.exports = flarum.core.compat['components/TextEditor'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['helpers/icon'];"],"sourceRoot":""}